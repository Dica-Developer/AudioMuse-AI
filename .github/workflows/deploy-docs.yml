name: Deploy Docs to GitHub Pages

on:
  push:
    branches:
      - main 

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest

    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install documentation dependencies
        run: |
          pip install mdsplit mkdocs mkdocs-material PyYAML # PyYAML is now explicitly needed by the Python script

      - name: Generate 'web' directory with mdsplit (Level 1 split)
        run: |
          # Important Reminders:
          # 1. Ensure your original README.md has its internal "Table of Contents" section removed.
          # 2. If you have a 'screenshot' folder, ensure it's placed directly INSIDE the 'web' folder
          #    in your repository (e.g., commit 'web/screenshot/image.png').
          # 3. Adjust image paths in your original README.md accordingly (e.g., '/screenshot/image.png'
          #    or relative to the web root depending on how you arrange them).
          mdsplit ./README.md -o web -l 1 -t -n

      - name: Generate mkdocs.yml navigation dynamically
        run: python .github/scripts/generate_nav.py # Execute the Python script

      - name: Configure GitHub Pages
        uses: actions/configure-pages@v5

      - name: Build MkDocs documentation
        run: mkdocs build

      - name: Upload artifact for deployment
        uses: actions/upload-pages-artifact@v3
        with:
          path: './site'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
