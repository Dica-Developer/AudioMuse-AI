name: Deploy Docs to GitHub Pages

on:
  push:
    branches:
      - main 

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest

    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install documentation dependencies
        run: |
          pip install mdsplit mkdocs mkdocs-material PyYAML # PyYAML is needed by the Python script

      - name: Generate 'web' directory with mdsplit (Level 2 split)
        run: |
          # CRUCIAL: Split at Level 2 headings to create multiple pages and subdirectories.
          # Ensure your original README.md has its internal "Table of Contents" section removed.
          # Ensure any 'screenshot' folder is placed directly INSIDE the 'web/' folder
          # in your repository (e.g., commit 'web/screenshot/image.png').
          # Adjust image paths in your original README.md accordingly (e.g., '../screenshot/image.png'
          # if referenced from a sub-page like 'web/4---Screenshots/4.1---Analysis-task.md').
          mdsplit ./README.md -o web -l 2 -t -n

      - name: Generate mkdocs.yml navigation dynamically
        run: python .github/scripts/generate_nav.py # Execute the Python script

      - name: Configure GitHub Pages
        uses: actions/configure-pages@v5

      - name: Build MkDocs documentation
        run: mkdocs build

      - name: Upload artifact for deployment
        uses: actions/upload-pages-artifact@v3
        with:
          path: './site'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
